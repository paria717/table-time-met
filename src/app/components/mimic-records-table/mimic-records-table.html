<section class="p-4">
  <!-- نوار ابزار -->
  <div class="toolbar">
    <label class="flex items-center gap-2">
      فیلتر تاریخ (شمسی):
      <!-- ورودی تاریخ شمسی: 1404/06/21 -->
      <input type="text" placeholder="مثال: 1404/06/21" (change)="onDateFilter($event)"
        (keyup.enter)="onDateFilter($event)" class="border border-gray-200 px-2 py-1 rounded-lg w-40" />
    </label>

    <button (click)="clearDateFilter()" class="border px-3 py-1 rounded">
      حذف فیلتر تاریخ
    </button>

    <button (click)="reload()" class="border px-3 py-1 rounded">
      بازخوانی
    </button>
  </div>

  <!-- جدول 1 -->
  <div class="card">
    <h3 class="title">کلاهدوز به علامه جعفری</h3>
    <div class="scroll" #root1>
      <ng-container *ngIf="dir1Shown.length; else empty1">
        <table>
          <thead>
            <tr>
              <th *ngFor="let k of visibleKeysTable1">
                <ng-container [ngSwitch]="k">
                  <button *ngSwitchCase="'datep'" (click)="toggleSort(1)" title="مرتب‌سازی بر اساس تاریخ">
                    {{ labelOf(k) }}
                    <span *ngIf="sortAsc1">▲</span><span *ngIf="!sortAsc1">▼</span>
                  </button>
                  <button *ngSwitchCase="'DateP'" (click)="toggleSort(1)" title="مرتب‌سازی بر اساس تاریخ">
                    {{ labelOf(k) }}
                    <span *ngIf="sortAsc1">▲</span><span *ngIf="!sortAsc1">▼</span>
                  </button>
                  <span *ngSwitchDefault>{{ labelOf(k) }}</span>
                </ng-container>
              </th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let r of dir1Shown; trackBy: trackByIndex">
              <td *ngFor="let k of visibleKeysTable1">
                <ng-container [ngSwitch]="k">

                  <ng-container *ngSwitchCase="'DateP'">
                    {{ r[k] ?? r['datep'] }}
                  </ng-container>
                  <ng-container *ngSwitchCase="'dateP'">
                    {{ r[k] ?? r['datep'] ?? r['DateP'] }}
                  </ng-container>
                  <ng-container *ngSwitchDefault>
                    {{ r[k] ?? '—' }}
                  </ng-container>
                </ng-container>
              </td>
            </tr>

            <tr>
              <td [attr.colspan]="visibleKeysTable1.length" class="loading">
                <div #sentinel1 style="height:1px"></div>
                <div *ngIf="dir1Loading">... در حال افزودن ردیف‌های بیشتر</div>
                <div *ngIf="!dir1HasMore && !dir1Loading">پایان داده‌ها</div>
              </td>
            </tr>
          </tbody>
        </table>
      </ng-container>

      <ng-template #empty1>
        <div class="empty" *ngIf="!loading"> empty data </div>
        <div class="loading" *ngIf="loading">در حال بارگذاری...</div>
      </ng-template>
    </div>
  </div>

  <!-- جدول 2 -->
  <div class="card">
    <h3 class="title">علامه جعفری به کلاهدوز</h3>
    <div class="scroll" #root2>
      <ng-container *ngIf="dir2Shown.length; else empty2">
        <table>
          <thead>
            <tr>
              <th *ngFor="let k of visibleKeysTable2">
                <ng-container [ngSwitch]="k">
                  <button *ngSwitchCase="'datep'" (click)="toggleSort(2)" title="مرتب‌سازی بر اساس تاریخ">
                    {{ labelOf(k) }}
                    <span *ngIf="sortAsc2">▲</span><span *ngIf="!sortAsc2">▼</span>
                  </button>
                  <button *ngSwitchCase="'DateP'" (click)="toggleSort(2)" title="مرتب‌سازی بر اساس تاریخ">
                    {{ labelOf(k) }}
                    <span *ngIf="sortAsc2">▲</span><span *ngIf="!sortAsc2">▼</span>
                  </button>
                  <span *ngSwitchDefault>{{ labelOf(k) }}</span>
                </ng-container>
              </th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let r of dir2Shown; trackBy: trackByIndex">
              <td *ngFor="let k of visibleKeysTable2">
                <ng-container [ngSwitch]="k">

                  <ng-container *ngSwitchCase="'DateP'">
                    {{ r[k] ?? r['datep'] }}
                  </ng-container>

                  <ng-container *ngSwitchDefault>
                    {{ r[k] ?? '—' }}
                  </ng-container>
                </ng-container>
              </td>
            </tr>

            <tr>
              <td [attr.colspan]="visibleKeysTable2.length" class="loading">
                <div #sentinel2 style="height:1px"></div>
                <div *ngIf="dir2Loading">... در حال افزودن ردیف‌های بیشتر</div>
                <div *ngIf="!dir2HasMore && !dir2Loading">پایان داده‌ها</div>
              </td>
            </tr>
          </tbody>
        </table>
      </ng-container>

      <ng-template #empty2>
        <div class="empty" *ngIf="!loading"> empty data</div>
        <div class="loading" *ngIf="loading">در حال بارگذاری...</div>
      </ng-template>
    </div>
  </div>
</section>