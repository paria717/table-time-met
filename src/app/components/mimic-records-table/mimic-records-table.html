<section class="p-4">
  <!-- نوار ابزار -->
  <div class="toolbar">
    <label class="flex items-center gap-2">
      فیلتر تاریخ (شمسی):
      <!-- ورودی تاریخ شمسی: 1404/06/21 -->
      <input type="text" placeholder="مثال: 1404/06/21" (change)="onDateFilter($event)"
        (keyup.enter)="onDateFilter($event)" class="border border-gray-200 px-2 py-1 rounded-lg w-40" />
    </label>

    <button (click)="clearDateFilter()" class="border px-3 py-1 rounded">
      حذف فیلتر تاریخ
    </button>
    <!-- <label> فیلتر شماره قطار :
      <input type="number" placeholder="مثال:331" (change)="onTrainNoFilter($event)"
        (keyup.enter)="onTrainNoFilter($event) " class="input">
    </label>
    <button type="button" (click)="clearTrainNoFilter()">پاک کردن شماره قطار</button> -->
    <button (click)="reload()" class="border px-3 py-1 rounded">
      بازخوانی
    </button>
    <button type="button" class="dir-toggle" (click)="toggleDirection()"
      [attr.aria-label]="activeDirection === 2 ? 'کلاهدوز به علامه جعفری' : 'علامه جعفری به کلاهدوز'">
      <span class="chip" [class.chip-active]="activeDirection === 2">کلاهدوز</span>
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
        stroke-linejoin="round" [class.rotate-180]="activeDirection === 1">
        <path d="M9 5l7 7-7 7"></path>
      </svg>
      <span class="chip" [class.chip-active]="activeDirection === 1">علامه جعفری</span>
    </button>
  </div>
  <div class="card">
    <section>
      <!-- جدول 1 -->
      <div class="table-wrap scroll" #root1 *ngIf="activeDirection === 1">
        <table>
          <thead>
            <tr>
              <th *ngFor="let k of visibleKeysTable1">{{ labelOf(k) }}</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let row of dir1Shown; trackBy: trackByIndex">
              <td *ngFor="let k of visibleKeysTable1">{{ row[k] }}</td>
            </tr>
          </tbody>
        </table>
        <div #sentinel1 class="sentinel"></div>
      </div>

      <!-- جدول 2 -->
      <div class="table-wrap scroll" #root2 *ngIf="activeDirection === 2">
        <table>
          <thead>
            <tr>
              <th *ngFor="let k of visibleKeysTable2">{{ labelOf(k) }}</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let row of dir2Shown; trackBy: trackByIndex">
              <td *ngFor="let k of visibleKeysTable2">{{ row[k] }}</td>
            </tr>
          </tbody>
        </table>
        <div #sentinel2 class="sentinel"></div>
      </div>
    </section>
  </div>
  <!-- جدول 1 -->
  <!-- <div class="card">
    <h3 class="title">کلاهدوز به علامه جعفری</h3>
    <div class="scroll" #root1>
      <ng-container *ngIf="dir1Shown.length; else empty1">
        <table>
          <thead>
            <tr>
              <th *ngFor="let k of visibleKeysTable1">
                <ng-container [ngSwitch]="k">
                  <button *ngSwitchCase="'datep'" (click)="toggleSort(1)" title="مرتب‌سازی بر اساس تاریخ">
                    {{ labelOf(k) }}
                    <span *ngIf="sortAsc1">▲</span><span *ngIf="!sortAsc1">▼</span>
                  </button>
                  <button *ngSwitchCase="'DateP'" (click)="toggleSort(1)" title="مرتب‌سازی بر اساس تاریخ">
                    {{ labelOf(k) }}
                    <span *ngIf="sortAsc1">▲</span><span *ngIf="!sortAsc1">▼</span>
                  </button>
                  <span *ngSwitchDefault>{{ labelOf(k) }}</span>
                </ng-container>
              </th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let r of dir1Shown; trackBy: trackByIndex">
              <td *ngFor="let k of visibleKeysTable1">
                <ng-container [ngSwitch]="k">

                  <ng-container *ngSwitchCase="'DateP'">
                    {{ r[k] ?? r['datep'] }}
                  </ng-container>
                  <ng-container *ngSwitchCase="'dateP'">
                    {{ r[k] ?? r['datep'] ?? r['DateP'] }}
                  </ng-container>
                  <ng-container *ngSwitchDefault>
                    {{ r[k] ?? '—' }}
                  </ng-container>
                </ng-container>
              </td>
            </tr>

            <tr>
              <td [attr.colspan]="visibleKeysTable1.length" class="loading">
                <div #sentinel1 style="height:1px"></div>
                <div *ngIf="dir1Loading">... در حال افزودن ردیف‌های بیشتر</div>
                <div *ngIf="!dir1HasMore && !dir1Loading">پایان داده‌ها</div>
              </td>
            </tr>
          </tbody>
        </table>
      </ng-container>

      <ng-template #empty1>
        <div class="empty" *ngIf="!loading"> empty data </div>
        <div class="loading" *ngIf="loading">در حال بارگذاری...</div>
      </ng-template>
    </div>
  </div> -->

  <!-- جدول 2 -->
  <!-- <div class="card">
    <h3 class="title">علامه جعفری به کلاهدوز</h3>
    <div class="scroll" #root2>
      <ng-container *ngIf="dir2Shown.length; else empty2">
        <table>
          <thead>
            <tr>
              <th *ngFor="let k of visibleKeysTable2">
                <ng-container [ngSwitch]="k">
                  <button *ngSwitchCase="'datep'" (click)="toggleSort(2)" title="مرتب‌سازی بر اساس تاریخ">
                    {{ labelOf(k) }}
                    <span *ngIf="sortAsc2">▲</span><span *ngIf="!sortAsc2">▼</span>
                  </button>
                  <button *ngSwitchCase="'DateP'" (click)="toggleSort(2)" title="مرتب‌سازی بر اساس تاریخ">
                    {{ labelOf(k) }}
                    <span *ngIf="sortAsc2">▲</span><span *ngIf="!sortAsc2">▼</span>
                  </button>
                  <span *ngSwitchDefault>{{ labelOf(k) }}</span>
                </ng-container>
              </th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let r of dir2Shown; trackBy: trackByIndex">
              <td *ngFor="let k of visibleKeysTable2">
                <ng-container [ngSwitch]="k">

                  <ng-container *ngSwitchCase="'DateP'">
                    {{ r[k] ?? r['datep'] }}
                  </ng-container>

                  <ng-container *ngSwitchDefault>
                    {{ r[k] ?? '—' }}
                  </ng-container>
                </ng-container>
              </td>
            </tr>

            <tr>
              <td [attr.colspan]="visibleKeysTable2.length" class="loading">
                <div #sentinel2 style="height:1px"></div>
                <div *ngIf="dir2Loading">... در حال افزودن ردیف‌های بیشتر</div>
                <div *ngIf="!dir2HasMore && !dir2Loading">پایان داده‌ها</div>
              </td>
            </tr>
          </tbody>
        </table>
      </ng-container>

      <ng-template #empty2>
        <div class="empty" *ngIf="!loading"> empty data</div>
        <div class="loading" *ngIf="loading">در حال بارگذاری...</div>
      </ng-template>
    </div>
  </div> -->
</section>